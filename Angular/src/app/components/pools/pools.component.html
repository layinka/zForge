<div class="row">
  <div class="col-12">
    <div class="text-center mb-5">
      <h1 class="gradient-text display-4 fw-bold">Trading Pools</h1>
      <p class="lead text-muted">
        Trade your PT and YT tokens on decentralized exchanges
      </p>
    </div>
  </div>
</div>

<!-- Pool Statistics -->
<div class="row g-4 mb-5">
  <div class="col-md-3">
    <div class="card stats-card text-center">
      <div class="card-body">
        <i class="bi bi-water display-4 text-primary mb-3"></i>
        <h4 class="gradient-text">$2.4M</h4>
        <p class="text-muted mb-0">Total TVL</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card text-center">
      <div class="card-body">
        <i class="bi bi-graph-up display-4 text-success mb-3"></i>
        <h4 class="text-success">$156K</h4>
        <p class="text-muted mb-0">24h Volume</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card text-center">
      <div class="card-body">
        <i class="bi bi-shield-check display-4 text-warning mb-3"></i>
        <h4 class="text-warning">{{ ptPools().length }}</h4>
        <p class="text-muted mb-0">PT Pools</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card text-center">
      <div class="card-body">
        <i class="bi bi-lightning display-4 text-info mb-3"></i>
        <h4 class="text-info">{{ ytPools().length }}</h4>
        <p class="text-muted mb-0">YT Pools</p>
      </div>
    </div>
  </div>
</div>

<!-- Pool Filters -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="btn-group" role="group">
              <input 
                type="radio" 
                class="btn-check" 
                name="poolFilter" 
                id="all" 
                [(ngModel)]="selectedFilter" 
                value="all"
                autocomplete="off">
              <label class="btn btn-outline-primary" for="all">All Pools</label>

              <input 
                type="radio" 
                class="btn-check" 
                name="poolFilter" 
                id="pt" 
                [(ngModel)]="selectedFilter" 
                value="PT"
                autocomplete="off">
              <label class="btn btn-outline-primary" for="pt">PT Pools</label>

              <input 
                type="radio" 
                class="btn-check" 
                name="poolFilter" 
                id="yt" 
                [(ngModel)]="selectedFilter" 
                value="YT"
                autocomplete="off">
              <label class="btn btn-outline-primary" for="yt">YT Pools</label>
            </div>
          </div>
          <div class="col-md-6 text-end">
            <div class="input-group" style="max-width: 300px; margin-left: auto;">
              <span class="input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Search pools..."
                [(ngModel)]="searchQuery">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Pools Table -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0">
          <i class="bi bi-list-ul me-2"></i>
          Available Pools
        </h4>
      </div>
      <div class="card-body">
        @if (filteredPools().length > 0) {
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Pool</th>
                  <th>Type</th>
                  <th>TVL</th>
                  <th>APY</th>
                  <th>24h Volume</th>
                  <th>Fee</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                @for (pool of filteredPools(); track pool.id) {
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="pool-icons me-3">
                          <div class="token-icon token-icon-primary">
                            {{ pool.token0Symbol.charAt(0) }}
                          </div>
                          <div class="token-icon token-icon-secondary">
                            {{ pool.token1Symbol.charAt(0) }}
                          </div>
                        </div>
                        <div>
                          <h6 class="mb-0">{{ pool.token0Symbol }}/{{ pool.token1Symbol }}</h6>
                          <small class="text-muted">{{ pool.id.slice(0, 8) }}...</small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span 
                        class="badge"
                        [class]="pool.type === 'PT' ? 'bg-primary' : 'bg-warning'">
                        {{ pool.type }}
                      </span>
                    </td>
                    <td>
                      <span class="fw-semibold">${{ formatNumber(pool.tvl) }}</span>
                    </td>
                    <td>
                      <span class="text-success fw-semibold">{{ pool.apy.toFixed(2) }}%</span>
                    </td>
                    <td>
                      <span class="text-muted">${{ formatNumber(pool.volume24h) }}</span>
                    </td>
                    <td>
                      <span class="text-muted">{{ pool.fee }}%</span>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <button 
                          class="btn btn-outline-primary"
                          (click)="openTradeModal(pool)">
                          Trade
                        </button>
                        <button 
                          class="btn btn-outline-success"
                          (click)="openLiquidityModal(pool)">
                          Add LP
                        </button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h5 class="text-muted mt-3">No pools found</h5>
            <p class="text-muted">Try adjusting your search or filter criteria</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Your Positions -->
@if (blockchainService.isConnected()) {
  <div class="row mt-5">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h4 class="mb-0">
            <i class="bi bi-person-workspace me-2"></i>
            Your Positions
          </h4>
        </div>
        <div class="card-body">
          @if (userPositions().length > 0) {
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Pool</th>
                    <th>Your Liquidity</th>
                    <th>Share</th>
                    <th>Earned Fees</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (position of userPositions(); track position.poolId) {
                    <tr>
                      <td>{{ position.poolName }}</td>
                      <td>${{ formatNumber(position.liquidity) }}</td>
                      <td>{{ position.share.toFixed(4) }}%</td>
                      <td class="text-success">${{ formatNumber(position.earnedFees) }}</td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <button class="btn btn-outline-warning">Remove</button>
                          <button class="btn btn-outline-success">Claim</button>
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="text-center py-4">
              <i class="bi bi-wallet2 display-1 text-muted"></i>
              <p class="text-muted mt-2">No liquidity positions found</p>
              <button class="btn btn-primary">Add Liquidity</button>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}

<!-- External DEX Links -->
<div class="row mt-5">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0">
          <i class="bi bi-box-arrow-up-right me-2"></i>
          External Trading
        </h4>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <div class="dex-card card text-center h-100">
              <div class="card-body">
                <h5 class="text-primary">Uniswap V3</h5>
                <p class="text-muted">Trade PT/YT tokens on Uniswap V3 with concentrated liquidity</p>
                <button class="btn btn-outline-primary">
                  Open Uniswap
                  <i class="bi bi-box-arrow-up-right ms-1"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="dex-card card text-center h-100">
              <div class="card-body">
                <h5 class="text-success">SushiSwap</h5>
                <p class="text-muted">Access PT/YT pools on SushiSwap with additional rewards</p>
                <button class="btn btn-outline-success">
                  Open SushiSwap
                  <i class="bi bi-box-arrow-up-right ms-1"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="dex-card card text-center h-100">
              <div class="card-body">
                <h5 class="text-warning">1inch</h5>
                <p class="text-muted">Get the best prices across multiple DEXs with 1inch aggregator</p>
                <button class="btn btn-outline-warning">
                  Open 1inch
                  <i class="bi bi-box-arrow-up-right ms-1"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
